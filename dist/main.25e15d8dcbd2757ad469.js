!function(t){function e(e){for(var a,i,c=e[0],s=e[1],l=e[2],f=0,p=[];f<c.length;f++)i=c[f],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);for(u&&u(e);p.length;)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(a=!1)}a&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},r={0:0},o=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="dist";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=s;o.push(["Vtdi",1]),n()}({OMi8:function(t,e,n){},Vtdi:function(t,e,n){"use strict";n.r(e);var a=n("bwSX"),r=n("+ugm"),o=n("pL0w"),i=n("wIsI"),c=n("EjHT"),s=n("nWpo"),l=n("8cru"),u=n("V183"),f=n("OWWo"),p=n("mrVq"),d=n("NltA"),v=n("wz8V"),h=n("h8nK"),g=n("AKWm"),b=n("AWXE"),m=n("4k54"),w=n("RhHs"),y=n("n0hd"),k=n("VIqg"),j=n("sCaM"),O=n("aj5g"),P=n("vHEj"),x=n("KU4y"),C=n.n(x),T=n("Wwog"),D=n("DzJC"),N=n.n(D),S=n("mVx/"),E=n.n(S),L=n("ytg1"),M=n.n(L),A=n("EVdn"),Y=n.n(A),W=n("LhCv"),I=n("0hfp");n("OMi8"),n("sQjb");function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(t){r=!0,o=t}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function _(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){F(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){var t,e,n="ontouchstart"in document.documentElement;n&&Y()(document.body).addClass("touch");var x=null,D=null,S=null,L=null,A={},z=null,R=null,X=null,H={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0},B=new Date(2020,0,21),K=null,q=null,J=null,Q=null,$=!1,G={cases:"Total Cases",deaths:"Total Deaths",tests:"Total Tests",positive:"Total Positive",pending:"Total Pending",negative:"Total Negative",newCases:"New Cases",newDeaths:"New Deaths",newTests:"New Tests",newPositive:"New Positive",newNegative:"New Negative",pop:"Est. Population"};Object.keys(G).forEach((function(t){G[gt(t)]=G[t]}));var Z=U({},G);Object.keys(Z).forEach((function(t){0===t.indexOf("new")&&(Z[t]="Avg ".concat(Z[t].replace("New","Daily")))}));var tt=(F(t={newCases:!0,newDeaths:!0},gt("newCases"),!0),F(t,gt("newDeaths"),!0),t),et={"7d":"Last 7 days","14d":"Last 14 days","1mo":"Last 30 days","90d":"Last 90 days",all:"All-time"},nt={"New York City":"36061","Kansas City":"29999"},at=(F(e={},"29999",505604),F(e,"29037",103525),F(e,"29095",386437),F(e,"29047",108919),F(e,"29165",48783),F(e,"36061",8336817),e),rt={36005:"36061",36047:"36061",36081:"36061",36085:"36061"},ot={state:"state",field:"field",time:"time",useLog:"log",per100k:"per100k",consistentY:"consistentY"},it={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0};function ct(t){for(var e="?"===t[0]?t.substring(1):t,n=e?e.split("&"):[],a={},r=0;r<n.length;r++){var o=V(n[r].split("=").map(decodeURIComponent),2),i=o[0],c=o[1];a[i]=c}return a}function st(t){var e=Object.keys(t).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))})).join("&");return e?"?".concat(e):""}var lt=new(function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.history=e,this.history.listen((function(){n.parse(),"all"===H.state?qt():Jt(H.state)}))}var e,n,a;return e=t,(n=[{key:"parse",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=ct(this.history.location.search),n=Object.keys(ot),a=0;a<n.length;a++){var r=n[a],o=ot[r],i=null!=e[o]?e[o]:it[r];if("boolean"==typeof it[r]&&"string"==typeof i&&(i="1"===i),H[r]!==i||t)switch(r){case"state":i=i.replace("+"," "),H.state=i,Y()("#state-select").val(i);break;case"field":G[i]&&(H.field=i,Y()("#field-select").val(i),($="tests"===H.field||"newTests"===H.field)?(H.useLog=!1,Y()("#cb-use-log-scale").prop("checked",!1),e[ot.useLog]="0",Y()(".testing-legend").show(),Y()("#filter-use-log-scale").hide()):(Y()(".testing-legend").hide(),Y()("#filter-use-log-scale").show()),"newCases"===i||"newDeaths"===i?(Y()(".ma-legend .legend-field-label").text(G[i]),Y()(".ma-legend").show()):Y()(".ma-legend").hide());break;case"time":H.time=i,Y()("#time-select").val(i);break;case"useLog":H.useLog=i,Y()("#cb-use-log-scale").prop("checked",i);break;case"per100k":H.per100k=i,Y()("#cb-per-100k").prop("checked",i);break;case"consistentY":H.consistentY=i,Y()("#cb-consistent-y").prop("checked",i)}}}},{key:"push",value:function(t){this._update("push",t)}},{key:"replace",value:function(t){this._update("replace",t)}},{key:"_update",value:function(t,e){var n=U({},ct(this.history.location.search),{},e);this.history[t]({search:st(n)})}}])&&_(e.prototype,n),a&&_(e,a),t}())(W.a());function ut(t){var e=["cases","deaths","newCases","newDeaths"];return t&&e.push("positive","negative","pending","tests","newPositive","newNegative","newTests"),e}function ft(t){var e=Object.assign({},at);return t.forEach((function(t){var n=rt[t.fips]||t.fips;e[n]=at[n]?at[n]:parseInt(t.pop)})),e}function pt(t,e,n){var a=ut(n);return t.forEach((function(t){for(var n=[],r=function(r){var o=t.values[r],i=V(o.date.split("-"),3),c=i[0],s=i[1],l=i[2],u=o.fips;!u&&o.county&&(u=nt[o.county]);var f=U({},o,{fips:u,date:new Date(Number(c),Number(s)-1,Number(l)),cases:Number(o.cases),deaths:Number(o.deaths),newCases:Number(o.newCases)});a.forEach((function(t){var e;f[t]=null==(e=f[t])?null:Number(e)})),n.push(f);var p=e[f.fips];if(p){f.pop=p;var d=p/1e5;a.forEach((function(t){"number"==typeof f[t]&&(f[gt(t)]=f[t]/d)}))}else t.noPopulation=!0;(null===K||f.date.getTime()>K.getTime())&&(K=f.date)},o=0;o<t.values.length;o++)r(o);t.values=n})),t}function dt(t,e,n){var a=ut(n),r=a.concat(a.map(gt)),o=["newCases","newDeaths"];o=o.concat(o.map(gt));var i={},c=["date"].concat(r);c.forEach((function(t){return i[t]=[null,null]}));var s=new Date(e[0]);s.setDate(s.getDate()-7);var l=function(t){return t.date.getTime()};return{groups:t.map((function(t){var n=t.values,a=[],r=e[0],f=mt(e),p=new Date(s),d=M()(n,{date:s},l),v={};o.forEach((function(t){v[t]=[]}));for(var h=function(){var t=p.getTime()>=r.getTime(),e=n[d],i=e&&e.date.getTime()===p.getTime()?e:null,c={};o.forEach((function(t){var n=v[t];7===n.length&&n.shift(),i&&"number"==typeof i[t]?n.push(e[t]):n.push(0),c[bt(t)]=Object(u.a)(n)})),t&&(i?a.push(Object.assign({},i,c)):a.push(Object.assign({date:new Date(p),fips:n[0].fips,pop:n[0].pop,state:n[0].state,county:n[0].county},c))),i&&d++,p.setDate(p.getDate()+1)};p.getTime()<=f.getTime();)h();return a.forEach((function(t){c.forEach((function(e){var n=i[e],a=t[e];if(null!=a&&(null===n[0]||a<n[0])&&(n[0]=a),null!=a&&(null===n[1]||a>n[1])&&(n[1]=a),tt[e]){var r=t[bt(e)];null!=r&&(null===n[1]||r>n[1])&&(n[1]=r)}}))})),U({},t,{values:a})})),extents:i}}lt.parse(!0);var vt=Object(T.a)(dt),ht=Object(T.a)(dt);function gt(t){return"".concat(t,"_p100k")}function bt(t){return"".concat(t,"_ma")}function mt(t){return t[t.length-1]}var wt=0;function yt(t){L=t;var e,a,r,o,i,c=t.groups,s=t.overview,l=t.isCounties,v=t.stateFips,h=H.per100k?gt(H.field):H.field;"7d"===H.time?e=7:"14d"===H.time?e=14:"1mo"===H.time?e=30:"90d"===H.time?e=90:(a=K,r=B,o=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate()),i=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),e=Math.floor((i-o)/864e5));for(var m=[K],w=1;w<e;w++){var y=new Date(K);y.setDate(K.getDate()-w),m.unshift(y)}if(l&&$)return Y()("#viz").hide(),void Y()(".testing-data-unavailable").show();Y()("#viz").show(),Y()(".testing-data-unavailable").hide();var k=ht(s,m,!0),j=vt(c,m,!l),x={field:h,daysToShow:e,datesToShow:m,isCounties:l,stateFips:v};!function(t,e){var n=Object(g.a)("#svg-overview"),a=n.node().getBoundingClientRect(),r=a.width,o=a.height,i=n.select("g.cell");i.selectAll("*").remove();var c=window.innerWidth>=1024,s=c?40:30,l=r-s-16,u=o-(c?20:14);i.attr("transform","translate(".concat(s,", 0)")),Ot(n,t,U({},e,{allowDrilldown:!1,chartWidth:l,chartHeight:u,cellLabelX:6,cellLabelY:0,barPad:3}))}(k,x),function(t,e){var n=e.field,a=e.daysToShow,r=Object(g.a)("#grid");r.selectAll("*").remove(),r.attr("class",H.consistentY?"consistent-y":"");var o=t.groups.slice(0),i=window.innerWidth>=1024,c=i?30:25,s=i?40:35,l=i?250:150,u=Math.floor(window.innerWidth/(l+c)),p=Math.floor((window.innerWidth-c*(u+1))/u),v=o.length,h=Math.floor(p/2.15),b=i?40:30,m=i?20:14,w=window.innerWidth,y=a>10?1:2,k=p+c,j=h+m+s,O=Math.ceil(v/u),P=O*j,x=!e.isCounties;o.forEach((function(t){if(0===n.indexOf("new"))t.sortVal=Object(f.a)(t.values,(function(t){return t[n]}));else{var e=E()(t.values,(function(t){return null!=t[n]}));t.sortVal=e?e[n]:-1}})),o.sort((function(t,e){return e.sortVal-t.sortVal})),r.attr("viewBox",[0,0,w,P]).selectAll("g.row").data(Object(d.a)(O)).enter().append("g").attr("class","row").attr("transform",(function(t){return"translate(".concat(b,", ").concat(t*j,")")})).each((function(t){var e=(t+1)*u>o.length?o.length%u:u,n=Object(d.a)(e).map((function(e){return{row:t,col:e}}));Object(g.a)(this).selectAll("g.cell").data(n).enter().append("g").attr("class","cell").classed("cell-clickable",x&&!$).attr("transform",(function(t){return"translate(".concat(t.col*k,", 0)")}))})),Ot(r,U({},t,{groups:o}),U({},e,{allowDrilldown:x,chartWidth:p,chartHeight:h,cellLabelX:-20,cellLabelY:-10,barPad:y}))}(j,x);var T=++wt;Ut().then((function(){T===wt&&function(t,e){var a=e.field,r=e.isCounties,o=e.stateFips,i=t.groups,c=!r,s=Object(g.a)("#svg-map"),l=s.node().getBoundingClientRect(),d=l.width,v=l.height,h=d,m=v,w=Object(O.a)().translate([h/2,m/2]).scale(h),y=Object(P.a)().projection(w),k=Z[a],j=et[H.time];Object(g.a)("#map-title").text("Map of ".concat(k,", ").concat(j));var x=s.select("#map-g").attr("width",h).attr("height",m),T=[];if(r){var D=String(Number(o));T=X.filter((function(t){var e=String(t.id);return D===e.substring(0,4===e.length?1:2)}))}var N=r?z.filter((function(t){return t.id===Number(o)})):z,S=Boolean(N.length);Object(g.a)("#map-no-data").classed("shown",!S),Object(g.a)("#viz-map-header").style("opacity",S?1:0);var E=function(t,e){var n={},a=null!=t[0].values[0].tests,r=ut(a);return t.forEach((function(t){var e=t.values;if(e.length){var o=e[0],i=o.fips,c=o.pop,s={fips:i,pop:c,label:t.key,cases:Object(f.a)(e,(function(t){return t.newCases})),deaths:Object(f.a)(e,(function(t){return t.newDeaths})),newCases:Object(u.a)(e,(function(t){return t.newCases})),newDeaths:Object(u.a)(e,(function(t){return t.newDeaths}))};a&&(s.tests=Object(f.a)(e,(function(t){return t.newTests})),s.positive=Object(f.a)(e,(function(t){return t.newPositive})),s.positivePct=s.positive/s.tests,s.negative=Object(f.a)(e,(function(t){return t.newNegative})),s.negativePct=s.negative/s.tests,s.pending=Object(f.a)(e,(function(t){return t.newPending})),s.pendingPct=s.pending/s.tests,s.newTests=Object(u.a)(e,(function(t){return t.newTests})),s.newPositive=Object(u.a)(e,(function(t){return t.newPositive})),s.newPositivePct=s.newPositive/s.newTests,s.newNegative=Object(u.a)(e,(function(t){return t.newNegative})),s.newNegativePct=s.newNegative/s.newTests);var l=c/1e5;r.forEach((function(t){"number"==typeof s[t]&&(s[gt(t)]=s[t]/l)})),n[Number(i)]=s}})),e.map((function(t){var e=rt[t.id]||t.id,a=n[e];return U({id:t.id,feature:t},a)}))}(i,r?T:N),L=[];E.forEach((function(t){var e=t[a];"number"==typeof e&&e>0&&L.push(e)})),0===L.length&&L.push(1);var M=Object(p.a)(L),A=C()().domain(L).range(kt);function W(t){var e=t[a];return null!=e&&0!==e?A(e):"#999"}!function(t,e){Object(g.a)("#map-legend").selectAll(".map-legend-item").data([0,e].concat(t)).join((function(t){var e=t.append("div").attr("class","map-legend-item");return e.append("div").classed("map-legend-item-label",!0),e}),(function(t){return t}),(function(t){return t.remove()})).each((function(t,e){Y()(this).css("background-color",0===e?"#999":kt[e-1])})).select(".map-legend-item-label").text((function(t){return Nt(t,2)}))}(A.clusters(),M);var I=x.select("#map-states").selectAll(".map-state").data(r?N:E,(function(t){return t.id})).join((function(t){return t.append("path").attr("opacity",0).attr("class","map-state map-feat")}),(function(t){return t}),(function(t){t.transition().duration(350).attr("opacity",0).remove()}));I.attr("d",(function(t){return y(t.feature)})).transition().duration(jt?0:350).attr("opacity",1).attr("fill",r?"#999":W);var V=x.select("#map-counties").selectAll(".map-county").data(r?E:[],(function(t){return t.id})).join((function(t){return t.append("path").attr("opacity",0).attr("class",(function(t){return"map-county map-county-".concat(t.id," map-feat")}))}),(function(t){return t}),(function(t){t.transition().duration(350).attr("opacity",0).remove()})).attr("d",(function(t){return y(t.feature)})).attr("fill",W);V.transition().duration(jt?0:350).attr("opacity",1),x.select("#map-state-borders").datum(R).attr("d",y).attr("opacity",r?0:1);var _=r?V:I;function F(t){var e=b.b;t.label&&function(t){var e=t.value;Pt(U({},t,{title:e.label,subtitle:et[H.time],fieldLabels:Z}))}({value:t,field:a,evt:e,allowDrilldown:c&&!$})}var B=Object(g.a)("#map-backdrop");B.attr("width",d).attr("height",v),B.on("click",(function(){r&&Wt("all")})),n?_.on("click",(function(t){b.b.stopPropagation(),F(t)})).on("mouseleave",(function(){xt()})):_.on("click",(function(t){Wt(c?t.label:"all")})).on("mouseenter",F).on("mouseleave",(function(){xt()}));var K=jt?x:x.transition().duration(750);if(r&&N.length){var q=r?y.bounds(N[0]):null,J=q[1][0]-q[0][0],Q=q[1][1]-q[0][1],G=(q[0][0]+q[1][0])/2,tt=(q[0][1]+q[1][1])/2,nt=.9/Math.max(J/h,Q/m),at=[h/2-nt*G,m/2-nt*tt];K.attr("transform","translate("+at+")scale("+nt+")")}else K.attr("transform","translate(0)scale(1)");jt=!1}(j,x)}))}var kt=["#49006a","#672682","#874694","#a666a0","#c588a6","#e3aba6","#ffd09f"].reverse(),jt=!0;function Ot(t,e,a){var c=a.field,s=a.daysToShow,l=a.datesToShow,u=a.allowDrilldown,f=a.chartWidth,p=a.chartHeight,O=a.cellLabelX,P=a.cellLabelY,x=a.barPad,C=e.groups,T=e.extents,D=H.useLog?y.a:k.a,N=Object(j.a)().domain(Object(d.a)(l.length))[s>=90?"range":"rangeRound"]([0,f]).paddingInner(Math.floor(x*s*100/f)/100).paddingOuter(0),S=N.bandwidth(),E=l.map((function(t,e){return N(e)+S/2}));function L(t){var e=[0,Math.max(t[1],H.per100k?.1:10)];if(H.useLog){var n=Math.max(t[0],0)||(H.per100k?.01:1);for(e[0]=1;e[0]>=n;)e[0]/=10}return D().domain(e).range([p,0]).nice()}function M(t){var e=t.domain()[1],n=4;for(H.useLog&&(n=H.per100k?3:e<100?1:e<1e3?2:e<1e4?3:4);t.ticks(n).length>5;)n--;return Object(w.a)(t).ticks(n).tickSizeInner(-f).tickSizeOuter(0).tickFormat((function(t){return Nt(t).replace(/^0\./,".")}))}var A=L(T[c]),Y=M(A),W=t.selectAll("g.cell"),I=0;W.each((function(t,e){var a=this,s=Object(g.a)(this),d=C[e];if(d){I++;var w=d.values;s.append("line").attr("class","baseline").attr("y1",p).attr("y2",p).attr("x2",f);var y,k=A,j=Y;if(!H.consistentY){var x=Object(v.a)(w,(function(t){return t[c]}));if(tt[c]){var T=bt(c),D=Object(v.a)(w,(function(t){return t[T]}));x=Object(v.a)(x.concat(D))}j=M(k=L(x))}if(s.append("g").attr("transform","translate(0,0)").call(j),$?(y="newTests"===H.field?["newPositive","newNegative"]:["positive","negative"],H.per100k&&(y=y.map(gt))):y=[c],N.bandwidth()>=1){var W=Object(i.a)().keys(y)(w);s.selectAll("g.layer").data(W,(function(t){return t.key})).enter().append("g").attr("class",(function(t,e){return"layer layer-".concat(e+1," layer-").concat(t.key)})).selectAll(".bar").data((function(t){return t}),(function(t){return String(t.data.date.getTime())})).enter().append("rect").attr("class","bar").attr("width",S).attr("x",(function(t,e){return N(e)})).attr("y",(function(t){var e=k(t[1]);return Number.isNaN(e)?p:e})).attr("height",(function(t){var e=Math.max(p-k(t[1]-t[0]),0);return Number.isNaN(e)?0:e}))}else tt[c]||_(c,"chart-line");tt[c]?_(bt(c),"chart-line ma-line"):s.selectAll(".ma-line").remove();var V=s.append("line").attr("y1",0).attr("y2",p).attr("class","crosshair crosshair-hidden"),z=s.append("rect").attr("class","pointer").attr("width",f).attr("height",p);n?z.on("click",(function(){b.b.stopPropagation(),R.call(a)})):z.on("mousemove",R).on("click",F),s.on("mouseleave",(function(){V.classed("crosshair-hidden",!0),xt()})),s.append("text").text(C.length>1?"".concat(I,". ").concat(d.key):d.key).attr("x",O).attr("y",P).attr("class","cell-label").on("click",F),H.per100k&&d.noPopulation&&s.append("text").text("No population data").attr("x",f/2).attr("y",p/2).attr("class","cell-label-nopop")}function _(t,e){var n=S/2,a=Object(r.a)().x((function(t,e){return Math.round(N(e)+n)})).y((function(e){var n=Math.min(Math.floor(k(e[t])),p);return Number.isNaN(n)?p:n})).curve(o.a);s.append("path").attr("class",e).datum(w).attr("d",a)}function R(){var t=b.b,e=Object(m.a)(this)[0],n=Object(h.a)(E,e),a=E[n-1],r=E[n],o=null==a||Math.abs(e-r)<Math.abs(e-a)?n:n-1,i=l[o],s=w.find((function(t){return t.date.getTime()===i.getTime()}));if(s&&(s!==q||!J)){var f=Math.round(N(o)+S/2);V.attr("x1",f).attr("x2",f).classed("crosshair-hidden",!1),function(t){var e=t.value;Pt(U({},t,{title:Dt(e.date),fieldLabels:G}))}({value:s,field:c,evt:t,allowDrilldown:u&&!$})}}function F(){u&&(Wt(d.key),It("#viz"))}}));var V=mt(C[0].values).date,z=new Date(V);z.setDate(z.getDate()-s+1),W.append("text").attr("class","x-tick x-tick-start").attr("text-anchor","start").attr("x",0).attr("y",p+4).text(Tt(z)),W.append("text").attr("class","x-tick x-tick-end").attr("text-anchor","end").attr("x",f).attr("y",p+4).text(Tt(V))}function Pt(t){clearTimeout(Q);var e=t.value,n=t.field,a=t.evt,r=t.allowDrilldown,o=t.title,i=t.subtitle,c=t.fieldLabels;q=e,J=!0;var s=a.pageX,l=a.pageY,u=a.clientY,f={left:"",right:"",top:"",bottom:"",transform:""},p=window.innerWidth,d=window.innerHeight,v=document.body.getBoundingClientRect().height,h=s-250>0,g=s+250<p,b=u-250>0,m=u-250<d;b?f.bottom="".concat(v-l+10,"px"):f.top="".concat(l+10,"px"),g?f.left="".concat(s+10,"px"):h?f.right="".concat(p-s+10,"px"):b||!m?(f.left=s,f.transform="translateX(-50%)",f.bottom="".concat(v-l+10,"px")):m&&(f.left=s,f.transform="translateX(-50%)",f.top="".concat(l+10,"px"));var w,y=$,k=y?"col-3":"col-2";w="tests"===H.field?[{key:"positive",color:"primary1",pct:e.positivePct},{key:"negative",color:"primary2",pct:e.negativePct},{key:"pending",pct:e.pendingPct},{key:"tests"},{key:"cases"},{key:"deaths"}]:"newTests"===H.field?[{key:"newPositive",color:"primary1",pct:e.newPositivePct},{key:"newNegative",color:"primary2",pct:e.newNegativePct},{key:"newTests"},{key:"newCases"},{key:"newDeaths"}]:["cases","deaths","newCases","newDeaths"].map((function(t){return{key:t,color:t===n?"primary1":null}})),H.per100k&&(w=w.map((function(t){return U({},t,{key:gt(t.key),suffix:" per 100k",formatter:Lt})})),null!=e.pop&&w.push({key:"pop"}));var j=w.map((function(t){var n,a=t.formatter||At,r=e[t.key];return null==r?"":'\n        \t<div class="tooltip-dp-label '.concat(t.color||"",'">').concat(c[t.key],'</div>\n        \t<div class="tooltip-dp-val">').concat(a(r)).concat(t.suffix||"","</div>\n          ").concat(y?'\n            <div class="tooltip-dp-pct">\n              '.concat(null!=(n=t.pct)?"(".concat(Yt(n),")"):"","\n            </div>\n          "):"","\n        \t")})),O=r?'<div class="tooltip-drill"><span class="click">Click</span><span class="tap">Tap</span><span> to see counties</span></div>':"";Y()("#tooltip").addClass("shown").toggleClass("clickable",r).css(f).html("<div><h4>".concat(o,"</h4>\n        ").concat(i?"<h5>".concat(i,"</h5>"):"",'\n              <div class="tooltip-grid ').concat(k,'">\n                ').concat(j.join(""),"\n              </div>\n              ").concat(O,"</div>"))}function xt(){Q=setTimeout(Ct,n?500:50)}function Ct(){Y()("#tooltip").removeClass("shown"),J=!1}function Tt(t){return t.toLocaleString("default",{month:"short",day:"numeric"})}function Dt(t){return t.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}function Nt(t,e){var n;return t>=1e6?(t/=1e6,n="m"):t>=1e3&&(t/=1e3,n="k"),void 0!==e&&(t=parseFloat(t.toPrecision(e))),n?"".concat(t).concat(n):String(t)}var St=Object(c.a)(",.1f"),Et=Object(c.a)(",.2f");function Lt(t){return t>=1?St(t):Et(t)}var Mt=Object(c.a)(",d");function At(t){return Mt(t)}var Yt=Object(c.a)(".1%");function Wt(t){lt.push(F({},ot.state,t))}function It(t){var e=document.querySelector(t);e&&e.scrollIntoView||window.scrollTo(0,0),e.getBoundingClientRect().top>=0||e.scrollIntoView({behavior:"smooth",block:"start"})}var Vt=0;function zt(){Vt++,Y()(".wrapper").addClass("loading")}function _t(){--Vt<=0&&(Y()(".wrapper").removeClass("loading"),Vt=0)}var Rt=N()((function(){L&&yt(L)}),100);function Ut(){return Ut.promise||(Ut.promise=Object(s.a)("assets/us-counties.topojson").then((function(t){z=I.a(t,t.objects.states).features,R=I.b(t,t.objects.states,(function(t,e){return t!==e})),X=I.a(t,t.objects.counties).features}))),Ut.promise}window.addEventListener("resize",Rt);var Ft=Object(T.a)((function(){return new Promise((function(t,e){Object(l.a)("assets/fips-pop-sta.csv").then((function(e){var n=ft(e);t(n)})).catch(e)}))})),Xt=Object(T.a)((function(){return new Promise((function(t,e){Object(l.a)("assets/fips-pop-cty.csv").then((function(e){var n=ft(e);t(n)})).catch(e)}))})),Ht=Object(T.a)((function(t){return new Promise((function(e,n){var r="all"===t?"all":"90d";Promise.all([Object(l.a)("https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/state/".concat(r,".csv")),Ft()]).then((function(t){var n=V(t,2);!function(t,e){var n=pt(Object(a.a)().key((function(t){return t.state})).entries(t),e,!0);x=[],n.forEach((function(t){"US"===t.key?(t.key="United States",S=[t]):(A[t.key]||(A[t.key]=t.values[0].fips),x.push(t))}))}(n[0],n[1]),function t(e){if(!t.populated){t.populated=!0;var n=e.slice(0).sort((function(t,e){return t.key.localeCompare(e.key)})).map((function(t){return'<option value="'.concat(t.key,'">').concat(t.key,"</option>")})).join("");Y()("#state-select").html('<option value="all" selected>All States</option>'.concat(n)),"all"!==H.state&&Y()("#state-select").val(H.state)}}(x),e()})).catch(n)}))})),Bt=Object(T.a)((function(t,e){return new Promise((function(n,r){Kt().then((function(){var o="all"===e?"all":"90d",i=A[t];i?Promise.all([Object(l.a)("https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/county/".concat(o,"/").concat(i,".csv")),Xt()]).then((function(t){var e=V(t,2);!function(t,e){var n=Object(a.a)().key((function(t){return t.state})).entries(t),r={};n.forEach((function(t){var n=pt(Object(a.a)().key((function(t){return t.county})).entries(t.values),e,!1);r[t.key]={key:t.key,counties:n}})),D=r}(e[0],e[1]),n()})).catch(r):r(new Error("Could not find fips for state ".concat(t)))})).catch(r)}))}));function Kt(){return Ht(H.time)}function qt(){zt(),Kt().then((function(){yt({groups:x,overview:S}),Y()(".back-to-states").removeClass("shown"),Ct(),_t()})).catch((function(t){console.error(t),_t()}))}function Jt(t){zt(),function(t){return Bt(t,H.time)}(t).then((function(){!function(t){var e=D[t],n=x.filter((function(e){return e.key===t})),a=n?n[0].values[0].fips:null;yt({groups:e.counties,overview:n,isCounties:!0,stateFips:a}),Y()(".back-to-states").addClass("shown"),Ct()}(t),_t()})).catch((function(t){console.error(t),_t()}))}"all"===H.state?qt():Jt(H.state),Y()("#state-select").change((function(){Wt(Y()(this).val())})),Y()(".back-to-states").click((function(){Wt("all"),It("#viz-map")})),Y()("#field-select").change((function(){lt.push(F({},ot.field,Y()(this).val()))})),Y()("#time-select").change((function(){lt.push(F({},ot.time,Y()(this).val()))})),Y()("#tooltip").click((function(t){t.stopPropagation(),Y()(this).is(".clickable")&&q&&(Wt(q.state||q.label),q.label||It("#viz"))})),Y()("#cb-use-log-scale").change((function(){var t=Y()(this).is(":checked");lt.push(F({},ot.useLog,t?"1":"0"))})),Y()("#cb-per-100k").change((function(){var t=Y()(this).is(":checked");lt.push(F({},ot.per100k,t?"1":"0"))})),Y()("#cb-consistent-y").change((function(){var t=Y()(this).is(":checked");lt.push(F({},ot.consistentY,t?"1":"0"))})),Y()(document).on("click",(function(){xt()}))}()}});
//# sourceMappingURL=main.25e15d8dcbd2757ad469.js.map