{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/main.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","isTouchDevice","document","documentElement","$","body","addClass","stateData","countyData","usData","lastData","stateToFipsMap","stateFeatures","stateBorders","countyFeatures","filters","state","field","time","useLog","per100k","consistentY","firstCasesDate","Date","lastCasesDate","tooltipValue","tooltipShown","tooltipHideTimer","isTestingData","dataPointLabels","cases","deaths","tests","positive","negative","newCases","newDeaths","newTests","newPositive","newNegative","pop","keys","forEach","k","per100kKey","mapDataPointLabels","indexOf","replace","fieldHasMovingAverage","timeLabels","all","countyLabelToFips","populationOverrides","fipsRemapping","filterKeys","filterDefaults","parseQs","qs","query","substring","vars","split","obj","map","decodeURIComponent","v","stringifyQs","encodeURIComponent","join","router","hist","this","history","listen","parse","fetchAndRenderStates","fetchAndRenderCounties","firstParse","location","search","qsKey","undefined","val","prop","hide","show","_update","action","getValueKeys","withTesting","valueKeys","processPopulations","assign","fips","parseInt","processGroups","groups","popMap","hasTesting","group","newRows","row","values","date","year","month","county","parsed","Number","p100kFactor","noPopulation","getTime","filterData","datesToShow","hasTestingData","allValueKeys","concat","maKeys","extents","extentKeys","maStartDate","setDate","getDate","dateAccessor","g","startDate","endDate","last","curDate","valuesIndex","sortedIndexBy","maWindows","isWithinRange","nextValue","matchingValue","maValues","arr","maKey","d3mean","extent","maValue","filterGridData","memoizeOne","filterOverviewData","mapRenderCount","render","daysToShow","b","a","utc1","utc2","overview","isCounties","stateFips","UTC","getFullYear","getMonth","Math","floor","nextDate","unshift","overviewData","gridData","options","toLowerCase","text","renderLegend","$overview","d3select","node","getBoundingClientRect","width","height","$cell","select","selectAll","remove","useLarge","innerWidth","yAxisWidth","chartWidth","chartHeight","attr","renderCharts","allowDrilldown","cellLabelX","cellLabelY","barPad","renderOverview","$svg","chartXPadding","chartYPadding","estChartWidth","numCols","numStates","xAxisHeight","winWidth","colWidth","rowHeight","numRows","ceil","totalHeight","sortVal","d3sum","lastVal","findLast","sort","d3range","enter","append","each","numColsForRow","range","col","classed","renderGrid","_mapRenderCount","fetchMapData","then","$map","mapWidth","mapHeight","projection","d3geoAlbersUsa","translate","scale","path","d3geoPath","fieldTitle","timeTitle","$g","countyFeaturesFiltered","_stateFips","String","filter","f","id","stateFeaturesFiltered","hasMapData","Boolean","style","joinedData","features","byFips","hasTests","fields","label","positivePct","negativePct","newPositivePct","newNegativePct","feature","aggMapData","domain","min","d3min","colorScale","scaleCluster","mapColors","fillColor","datum","clusters","$item","update","exit","css","formatNumNice","renderMapLegend","$states","transition","duration","isFirstMapRender","$counties","$features","onMouseEnter","evt","d3event","showTooltip","title","subtitle","fieldLabels","showMapTooltip","$backdrop","on","setStateFilter","stopPropagation","hideTooltipSoon","$gSel","bounds","xWidth","yHeight","xCenter","yCenter","max","renderMap","reverse","yScaleType","d3scaleLog","d3scaleLinear","xScale","d3scaleBand","paddingInner","paddingOuter","barWidth","bandwidth","barXMidpoints","makeYScale","extentMin","nice","makeAxis","domainMax","numTicks","ticks","d3axisLeft","tickSizeInner","tickSizeOuter","tickFormat","yScale","yAxis","$cells","counter","index","stackFields","cellYScale","cellYAxis","d3extent","maField","maExtent","stack","d3stack","$layers","y","isNaN","area","d3area","x","y0","y1","renderLine","$crosshair","$hover","onMouseMove","onClick","yProperty","classes","xOffset","line","d3line","round","curve","d3curveMonotoneX","xPos","d3mouse","bisectIndex","d3bisectLeft","left","right","abs","find","chPos","formatTooltipDate","showChartTooltip","scrollUpTo","formatXDate","clearTimeout","pageX","pageY","clientY","top","bottom","transform","winHeight","innerHeight","bodyHeight","fitsLeft","fitsRight","fitsTop","fitsBottom","dataPoints","hasPercents","columnClass","color","pct","dp","suffix","formatter","formatPer100kValue","dataPointEl","format","formatTooltipValue","dpValue","pctFmt","drilldownMsg","toggleClass","html","setTimeout","hideTooltip","removeClass","toLocaleString","day","precision","abbrev","parseFloat","toPrecision","tooltipFmtPer100k","d3format","tooltipFmtPer100kSmall","tooltipFmt","selector","el","querySelector","scrollIntoView","scrollTo","behavior","block","loadingCount","startLoading","completeLoading","resizeWindow","throttle","promise","d3json","us","topojson","objects","states","counties","addEventListener","fetchStatePopulationsMemo","Promise","resolve","reject","d3csv","popCsv","catch","fetchCountyPopulationsMemo","fetchStateDataMemo","timeFilter","file","csv","processed","d3nest","entries","processStates","populateStateSelect","populated","stateOptions","localeCompare","fetchCountyDataMemo","fetchStateData","timeDir","nestedStates","stateMap","byCounty","processCounties","Error","error","console","fetchCountyData","countiesForState","renderCounties","change","click","is"],"mappings":"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","file":"main.692cc6044d11b1661e08.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"Vtdi\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import {nest as d3nest} from 'd3-collection';\nimport {stack as d3stack, line as d3line, curveMonotoneX as d3curveMonotoneX, area as d3area} from 'd3-shape';\nimport {format as d3format} from 'd3-format';\nimport {json as d3json, csv as d3csv} from 'd3-fetch';\nimport {\n  mean as d3mean,\n  sum as d3sum,\n  min as d3min,\n  range as d3range,\n  extent as d3extent,\n  bisectLeft as d3bisectLeft,\n} from 'd3-array';\nimport {select as d3select, mouse as d3mouse, event as d3event} from 'd3-selection';\nimport {axisLeft as d3axisLeft} from 'd3-axis';\nimport {\n  scaleBand as d3scaleBand,\n  scaleLog as d3scaleLog,\n  scaleLinear as d3scaleLinear,\n} from 'd3-scale';\nimport {geoAlbersUsa as d3geoAlbersUsa, geoPath as d3geoPath} from 'd3-geo';\nimport scaleCluster from 'd3-scale-cluster';\nimport memoizeOne from 'memoize-one';\nimport throttle from 'lodash/throttle';\nimport findLast from 'lodash/findLast';\nimport sortedIndexBy from 'lodash/sortedIndexBy';\nimport $ from 'jquery';\nimport * as history from 'history';\nimport * as topojson from 'topojson-client';\nimport './style.css';\nimport 'd3-transition';\n\n(function () {\n  const isTouchDevice = 'ontouchstart' in document.documentElement;\n  if (isTouchDevice) {\n    $(document.body).addClass('touch');\n  }\n\n  // Data\n  let stateData = null;\n  let countyData = null;\n  let usData = null;\n  let lastData = null;\n\n  let stateToFipsMap = {};\n\n  // Map features\n  let stateFeatures = null;\n  let stateBorders = null;\n  let countyFeatures = null;\n\n  // Filter values\n  const filters = {\n    state: 'all',\n    field: 'newCases',\n    time: '14d',\n    useLog: false,\n    per100k: false,\n    consistentY: true,\n  };\n\n  // UI state\n  let firstCasesDate = new Date(2020, 0, 21);\n  let lastCasesDate = null;\n  let tooltipValue = null;\n  let tooltipShown = null;\n  let tooltipHideTimer = null;\n  let isTestingData = false;\n\n  ///////////////\n  // Constants //\n  ///////////////\n\n  const dataPointLabels = {\n    cases: 'Total Cases',\n    deaths: 'Total Deaths',\n    tests: 'Total Tests',\n    positive: 'Total Positive',\n    negative: 'Total Negative',\n    newCases: 'New Cases',\n    newDeaths: 'New Deaths',\n    newTests: 'New Tests',\n    newPositive: 'New Positive',\n    newNegative: 'New Negative',\n    pop: 'Est. Population',\n  };\n  Object.keys(dataPointLabels).forEach((k) => {\n    dataPointLabels[per100kKey(k)] = dataPointLabels[k];\n  });\n\n  // On the map, \"daily new\" fields are averages\n  const mapDataPointLabels = {...dataPointLabels};\n  Object.keys(mapDataPointLabels).forEach((key) => {\n    if (key.indexOf('new') === 0) {\n      mapDataPointLabels[key] = `Avg ${mapDataPointLabels[key].replace('New', 'Daily')}`;\n    }\n  });\n\n  const fieldHasMovingAverage = {\n    newCases: true,\n    newDeaths: true,\n    [per100kKey('newCases')]: true,\n    [per100kKey('newDeaths')]: true,\n  };\n\n  const timeLabels = {\n    '7d': 'Last 7 days',\n    '14d': 'Last 14 days',\n    '1mo': 'Last 30 days',\n    '90d': 'Last 90 days',\n    all: 'All-time',\n  };\n\n  const MA_NUM_DAYS = 7;\n\n  const KANSAS_CITY_FAKE_FIPS = '29999';\n\n  // https://github.com/nytimes/covid-19-data#geographic-exceptions\n  const countyLabelToFips = {\n    'New York City': '36061',\n    'Kansas City': KANSAS_CITY_FAKE_FIPS,\n  };\n\n  const populationOverrides = {\n    // Kansas City, MO edge cases. City is not a real county, it overlaps\n    // with four other counties. Mayor posted a tweet with population estimates\n    // for the city overall, and the parts of the counties that fall within the city.\n    // https://twitter.com/QuintonLucasKC/status/1249756319805997058\n    [KANSAS_CITY_FAKE_FIPS]: 505604,\n    // Cass County, MO\n    '29037': 103610 - 85,\n    // Jackson County, MO\n    '29095': 700307 - 313870,\n    // Clay County, MO\n    '29047': 246365 - 137446,\n    // Platte County, MO\n    '29165': 102985 - 54202,\n\n    // New York City - Sum of the 5 boroughs due to NYT geographic exception\n    '36061': 8336817,\n  };\n\n  const fipsRemapping = {\n    // Bronx -> NY\n    '36005': '36061',\n    // Kings -> NY,\n    '36047': '36061',\n    // Queens -> NY\n    '36081': '36061',\n    // Richmond -> NY\n    '36085': '36061',\n  };\n\n  ////////////\n  // Router //\n  ////////////\n\n  const filterKeys = {\n    state: 'state',\n    field: 'field',\n    time: 'time',\n    useLog: 'log',\n    per100k: 'per100k',\n    consistentY: 'consistentY',\n  };\n  const filterDefaults = {\n    state: 'all',\n    field: 'newCases',\n    time: '14d',\n    useLog: false,\n    per100k: true,\n    consistentY: true,\n  };\n\n  class Router {\n    constructor(hist) {\n      this.history = hist;\n      this.history.listen(() => {\n        // Update filter state variables and re-render\n        this.parse();\n        if (filters.state === 'all') {\n          fetchAndRenderStates();\n        } else {\n          fetchAndRenderCounties(filters.state);\n        }\n      });\n    }\n\n    parse(firstParse = false) {\n      const qs = parseQs(this.history.location.search);\n      const keys = Object.keys(filterKeys);\n\n      for (let i = 0; i < keys.length; i++) {\n        const k = keys[i];\n        const qsKey = filterKeys[k];\n        let v = qs[qsKey] != undefined ? qs[qsKey] : filterDefaults[k];\n        // Coerce boolean filter values from string to boolean\n        if (typeof filterDefaults[k] === 'boolean' && typeof v === 'string') {\n          v = v === '1';\n        }\n        if (filters[k] === v && !firstParse) {\n          continue;\n        }\n        switch (k) {\n          case 'state': {\n            // Somehow URLs with plus instead of space are being used\n            v = v.replace('+', ' ');\n            filters.state = v;\n            $('#state-select').val(v);\n            break;\n          }\n          case 'field': {\n            if (dataPointLabels[v]) {\n              filters.field = v;\n              $('#field-select').val(v);\n\n              isTestingData = v === 'tests' || v === 'newTests';\n              if (isTestingData) {\n                // Disable useLog if switching to testing data\n                filters.useLog = false;\n                $('#cb-use-log-scale').prop('checked', false);\n                qs[filterKeys.useLog] = '0';\n                $('#filter-use-log-scale').hide();\n              } else {\n                $('#filter-use-log-scale').show();\n              }\n            }\n            break;\n          }\n          case 'time': {\n            filters.time = v;\n            $('#time-select').val(v);\n            break;\n          }\n          case 'useLog': {\n            filters.useLog = v;\n            $('#cb-use-log-scale').prop('checked', v);\n            break;\n          }\n          case 'per100k': {\n            filters.per100k = v;\n            $('#cb-per-100k').prop('checked', v);\n            break;\n          }\n          case 'consistentY': {\n            filters.consistentY = v;\n            $('#cb-consistent-y').prop('checked', v);\n            break;\n          }\n        }\n      }\n    }\n\n    push(obj) {\n      this._update('push', obj);\n    }\n\n    replace(obj) {\n      this._update('replace', obj);\n    }\n\n    _update(action, obj) {\n      const query = {\n        ...parseQs(this.history.location.search),\n        ...obj,\n      };\n      this.history[action]({\n        search: stringifyQs(query),\n      });\n    }\n  }\n\n  function parseQs(qs) {\n    const query = qs[0] === '?' ? qs.substring(1) : qs;\n    const vars = query ? query.split('&') : [];\n    const obj = {};\n    for (let i = 0; i < vars.length; i++) {\n      const [k, v] = vars[i].split('=').map(decodeURIComponent);\n      obj[k] = v;\n    }\n    return obj;\n  }\n  function stringifyQs(obj) {\n    const result = Object.keys(obj)\n      .map((k) => {\n        return `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`;\n      })\n      .join('&');\n    return result ? `?${result}` : '';\n  }\n  const router = new Router(history.createBrowserHistory());\n  router.parse(true);\n\n  /////////////////////\n  // Data Processing //\n  /////////////////////\n\n  function getValueKeys(withTesting) {\n    const valueKeys = ['cases', 'deaths', 'newCases', 'newDeaths'];\n    if (withTesting) {\n      valueKeys.push(\n        'positive',\n        'negative',\n        'newPositive',\n        'newNegative',\n        'newTests',\n      );\n    }\n    return valueKeys;\n  }\n\n  function processStates(csv, popMap) {\n    const nestedStates = d3nest()\n      .key((k) => k.state)\n      .entries(csv);\n\n    const processed = processGroups(nestedStates, popMap, true);\n\n    stateData = [];\n    processed.forEach((group) => {\n      if (group.key === 'US') {\n        group.key = 'United States';\n        usData = [group];\n      } else {\n        if (!stateToFipsMap[group.key]) {\n          stateToFipsMap[group.key] = group.values[0].fips;\n        }\n        stateData.push(group);\n      }\n    });\n  }\n\n  function coerceNumber(value) {\n    return value == undefined ? null : Number(value);\n  }\n\n  function processCounties(csv, popMap) {\n    // First nest counties by state\n    const nestedStates = d3nest()\n      .key((k) => k.state)\n      .entries(csv);\n\n    const stateMap = {};\n\n    nestedStates.forEach((state) => {\n      const counties = d3nest()\n        .key((k) => k.county)\n        .entries(state.values);\n      const byCounty = processGroups(counties, popMap, false);\n      stateMap[state.key] = {key: state.key, counties: byCounty};\n    });\n\n    countyData = stateMap;\n  }\n\n  function processPopulations(pop) {\n    const map = Object.assign({}, populationOverrides);\n    pop.forEach((p) => {\n      const fips = fipsRemapping[p.fips] || p.fips;\n      if (populationOverrides[fips]) {\n        map[fips] = populationOverrides[fips];\n      } else {\n        map[fips] = parseInt(p.pop);\n      }\n    });\n    return map;\n  }\n\n  function processGroups(groups, popMap, hasTesting) {\n    const valueKeys = getValueKeys(hasTesting);\n\n    groups.forEach((group) => {\n      const newRows = [];\n      for (let i = 0; i < group.values.length; i++) {\n        const row = group.values[i];\n        const [year, month, date] = row.date.split('-');\n\n        let fips = row.fips;\n        if (!fips && row.county) {\n          fips = countyLabelToFips[row.county];\n        }\n\n        const parsed = {\n          ...row,\n          fips,\n          date: new Date(Number(year), Number(month) - 1, Number(date)),\n          cases: Number(row.cases),\n          deaths: Number(row.deaths),\n          newCases: Number(row.newCases),\n        };\n        valueKeys.forEach((key) => {\n          parsed[key] = coerceNumber(parsed[key]);\n        });\n\n        newRows.push(parsed);\n\n        // Add population-normalized data\n        const pop = popMap[parsed.fips];\n        if (pop) {\n          parsed.pop = pop;\n          const p100kFactor = pop / 1e5;\n          valueKeys.forEach((key) => {\n            if (typeof parsed[key] === 'number') {\n              parsed[per100kKey(key)] = parsed[key] / p100kFactor;\n            }\n          });\n        } else {\n          group.noPopulation = true;\n        }\n\n        if (lastCasesDate === null || parsed.date.getTime() > lastCasesDate.getTime()) {\n          lastCasesDate = parsed.date;\n        }\n      }\n      group.values = newRows;\n    });\n\n    return groups;\n  }\n\n  function filterData(groups, datesToShow, hasTestingData) {\n    const valueKeys = getValueKeys(hasTestingData);\n    const allValueKeys = valueKeys.concat(valueKeys.map(per100kKey));\n\n    // Keys for which to compute moving averages\n    let maKeys = ['newCases', 'newDeaths'];\n    maKeys = maKeys.concat(maKeys.map(per100kKey));\n\n    const extents = {};\n    const extentKeys = ['date'].concat(allValueKeys);\n    extentKeys.forEach((key) => (extents[key] = [null, null]));\n\n    const maStartDate = new Date(datesToShow[0]);\n    maStartDate.setDate(maStartDate.getDate() - MA_NUM_DAYS);\n\n    const dateAccessor = (v) => v.date.getTime();\n\n    const newGroups = groups.map((g) => {\n      const {values} = g;\n      const newRows = [];\n\n      // Start/end date of the visualized range\n      let startDate = datesToShow[0];\n      let endDate = last(datesToShow);\n      // However we start 7 days before to calculate moving averages\n      let curDate = new Date(maStartDate);\n\n      // Using sortedIndexBy to binary search for the index where our dates start\n      let valuesIndex = sortedIndexBy(values, {date: maStartDate}, dateAccessor);\n\n      // Data structure to store our N-day moving average window for each field\n      let maWindows = {};\n      maKeys.forEach((key) => {\n        maWindows[key] = [];\n      });\n\n      while (curDate.getTime() <= endDate.getTime()) {\n        // Is this date within our visualized range?\n        let isWithinRange = curDate.getTime() >= startDate.getTime();\n\n        // Peek at the next value in our values array  is there a value for the current date?\n        let nextValue = values[valuesIndex];\n        let matchingValue =\n          nextValue && nextValue.date.getTime() === curDate.getTime() ? nextValue : null;\n\n        // First update moving averages\n        let maValues = {};\n        maKeys.forEach((key) => {\n          const arr = maWindows[key];\n          if (arr.length === MA_NUM_DAYS) {\n            arr.shift();\n          }\n          // If there is data for the current date/field combo, use that.\n          if (matchingValue && typeof matchingValue[key] === 'number') {\n            arr.push(nextValue[key]);\n          } else {\n            arr.push(0);\n          }\n          // Store today's moving average as the mean of our moving average window\n          maValues[maKey(key)] = d3mean(arr);\n        });\n\n        // For dates that will be visualized, push a value into the newRows array\n        if (isWithinRange) {\n          if (matchingValue) {\n            newRows.push(Object.assign({}, matchingValue, maValues));\n          } else {\n            // If there was no matching value for today, all we have is a moving average,\n            // just generate a fake data point with the average values\n            newRows.push(\n              Object.assign(\n                {\n                  date: new Date(curDate),\n                  fips: values[0].fips,\n                  pop: values[0].pop,\n                  state: values[0].state,\n                  county: values[0].county,\n                },\n                maValues,\n              ),\n            );\n          }\n        }\n\n        // If current index of values array was a match for this date, we want to move to next.\n        if (matchingValue) {\n          valuesIndex++;\n        }\n\n        // Make next loop iteration use tomorrow's date\n        curDate.setDate(curDate.getDate() + 1);\n      }\n\n      // Update the extents object\n      newRows.forEach((row) => {\n        extentKeys.forEach((key) => {\n          const extent = extents[key];\n          const value = row[key];\n          if (value != undefined && (extent[0] === null || value < extent[0])) {\n            extent[0] = value;\n          }\n          if (value != undefined && (extent[1] === null || value > extent[1])) {\n            extent[1] = value;\n          }\n          // Account for moving averages in the extent\n          if (fieldHasMovingAverage[key]) {\n            const maValue = row[maKey(key)];\n            if (maValue != undefined && (extent[1] === null || maValue > extent[1])) {\n              extent[1] = maValue;\n            }\n          }\n        });\n      });\n\n      return {\n        ...g,\n        values: newRows,\n      };\n    });\n\n    return {groups: newGroups, extents};\n  }\n\n  const filterGridData = memoizeOne(filterData);\n  const filterOverviewData = memoizeOne(filterData);\n\n  function per100kKey(key) {\n    return `${key}_p100k`;\n  }\n\n  function maKey(key) {\n    return `${key}_ma`;\n  }\n\n  function last(arr) {\n    return arr[arr.length - 1];\n  }\n\n  let mapRenderCount = 0;\n  function render(data) {\n    lastData = data;\n    const {groups, overview, isCounties, stateFips} = data;\n\n    const field = filters.per100k ? per100kKey(filters.field) : filters.field;\n\n    let daysToShow;\n    if (filters.time === '7d') {\n      daysToShow = 7;\n    } else if (filters.time === '14d') {\n      daysToShow = 14;\n    } else if (filters.time === '1mo') {\n      daysToShow = 30;\n    } else if (filters.time === '90d') {\n      daysToShow = 90;\n    } else {\n      daysToShow = dateDiffInDays(lastCasesDate, firstCasesDate);\n    }\n    const datesToShow = [lastCasesDate];\n    for (let i = 1; i < daysToShow; i++) {\n      const nextDate = new Date(lastCasesDate);\n      nextDate.setDate(lastCasesDate.getDate() - i);\n      datesToShow.unshift(nextDate);\n    }\n\n    if (isCounties && isTestingData) {\n      $('#viz').hide();\n      $('.testing-data-unavailable').show();\n      return;\n    } else {\n      $('#viz').show();\n      $('.testing-data-unavailable').hide();\n    }\n\n    const overviewData = filterOverviewData(overview, datesToShow, true);\n    const gridData = filterGridData(groups, datesToShow, !isCounties);\n\n    const options = {\n      field,\n      datesToShow,\n      isCounties,\n      stateFips,\n    };\n\n    renderLegend();\n    renderOverview(overviewData, options);\n    renderGrid(gridData, options);\n\n    // Render map after fetching map data (debounce the render calls)\n    const _mapRenderCount = ++mapRenderCount;\n    fetchMapData().then(() => {\n      if (_mapRenderCount === mapRenderCount) {\n        renderMap(gridData, options);\n      }\n    });\n  }\n\n  function aggMapData(groups, features) {\n    const byFips = {};\n\n    const hasTests = groups[0].values[0].tests != undefined;\n    const fields = getValueKeys(hasTests);\n\n    groups.forEach((group) => {\n      const {values} = group;\n      if (!values.length) {\n        return;\n      }\n      const {fips, pop} = values[0];\n\n      // Just aggregate the number of new cases/etc across the selected time range\n      let value = {\n        fips,\n        pop,\n        label: group.key,\n        // New cases/deaths over last N days\n        cases: d3sum(values, (v) => v.newCases),\n        deaths: d3sum(values, (v) => v.newDeaths),\n        // Average of new daily cases/deahts over last N days\n        newCases: d3mean(values, (v) => v.newCases),\n        newDeaths: d3mean(values, (v) => v.newDeaths),\n      };\n\n      if (hasTests) {\n        value.positive = d3sum(values, (v) => v.newPositive);\n        value.negative = d3sum(values, (v) => v.newNegative);\n        value.tests = value.positive + value.negative;\n        value.positivePct = value.positive / value.tests;\n        value.negativePct = value.negative / value.tests;\n        value.newPositive = d3mean(values, (v) => v.newPositive);\n        value.newNegative = d3mean(values, (v) => v.newNegative);\n        value.newTests = value.newPositive + value.newNegative;\n        value.newPositivePct = value.newPositive / value.newTests;\n        value.newNegativePct = value.newNegative / value.newTests;\n      }\n\n      const p100kFactor = pop / 1e5;\n      fields.forEach((field) => {\n        if (typeof value[field] === 'number') {\n          value[per100kKey(field)] = value[field] / p100kFactor;\n        }\n      });\n\n      byFips[Number(fips)] = value;\n    });\n\n    return features.map((f) => {\n      const fips = fipsRemapping[f.id] || f.id;\n      const data = byFips[fips];\n      return {\n        id: f.id,\n        feature: f,\n        ...data,\n      };\n    });\n  }\n\n  // https://gka.github.io/palettes/#/7|s|49006a,9b59b6,ffd09f|ffffe0,ff005e,93003a|1|1\n  const mapColors = [\n    '#49006a',\n    '#672682',\n    '#874694',\n    '#a666a0',\n    '#c588a6',\n    '#e3aba6',\n    '#ffd09f',\n  ].reverse();\n  const mapNoDataColor = '#999';\n\n  let isFirstMapRender = true;\n  function renderMap(data, options) {\n    const {field, isCounties, stateFips} = options;\n    const {groups} = data;\n\n    const allowDrilldown = !isCounties;\n\n    const $map = d3select('#svg-map');\n    const {width, height} = $map.node().getBoundingClientRect();\n    const mapWidth = width;\n    const mapHeight = height;\n\n    const projection = d3geoAlbersUsa()\n      .translate([mapWidth / 2, mapHeight / 2])\n      .scale(mapWidth);\n    const path = d3geoPath().projection(projection);\n\n    let fieldTitle = mapDataPointLabels[field];\n    if (filters.per100k) {\n      fieldTitle += ' per 100K';\n    }\n    const timeTitle = timeLabels[filters.time];\n    d3select('#map-title').text(`Map of ${fieldTitle}, ${timeTitle}`);\n\n    const $g = $map.select('#map-g').attr('width', mapWidth).attr('height', mapHeight);\n\n    let countyFeaturesFiltered = [];\n    if (isCounties) {\n      const _stateFips = String(Number(stateFips));\n      countyFeaturesFiltered = countyFeatures.filter((f) => {\n        const fips = String(f.id);\n        return _stateFips === fips.substring(0, fips.length === 4 ? 1 : 2);\n      });\n    }\n\n    let stateFeaturesFiltered = isCounties\n      ? stateFeatures.filter((f) => f.id === Number(stateFips))\n      : stateFeatures;\n\n    const hasMapData = Boolean(stateFeaturesFiltered.length);\n    d3select('#map-no-data').classed('shown', !hasMapData);\n    d3select('#viz-map-header').style('opacity', hasMapData ? 1 : 0);\n\n    const joinedData = aggMapData(\n      groups,\n      isCounties ? countyFeaturesFiltered : stateFeaturesFiltered,\n    );\n\n    const domain = [];\n    joinedData.forEach((d) => {\n      const value = d[field];\n      if (typeof value === 'number' && value > 0) {\n        domain.push(value);\n      }\n    });\n    if (domain.length === 0) {\n      domain.push(1);\n    }\n    const min = d3min(domain);\n    const colorScale = scaleCluster().domain(domain).range(mapColors);\n    const clusters = colorScale.clusters();\n    renderMapLegend(clusters, min);\n\n    function fillColor(d) {\n      const datum = d[field];\n      return datum != undefined && datum !== 0 ? colorScale(datum) : mapNoDataColor;\n    }\n\n    const $states = $g\n      .select('#map-states')\n      .selectAll('.map-state')\n      .data(isCounties ? stateFeaturesFiltered : joinedData, (d) => d.id)\n      .join(\n        (enter) => enter.append('path').attr('opacity', 0).attr('class', 'map-state map-feat'),\n        (update) => update,\n        (exit) => {\n          exit.transition().duration(350).attr('opacity', 0).remove();\n        },\n      );\n\n    $states\n      .attr('d', (d) => path(d.feature))\n      .transition()\n      .duration(isFirstMapRender ? 0 : 350)\n      .attr('opacity', 1)\n      .attr('fill', isCounties ? mapNoDataColor : fillColor);\n\n    const $counties = $g\n      .select('#map-counties')\n      .selectAll('.map-county')\n      .data(isCounties ? joinedData : [], (d) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr('opacity', 0)\n            .attr('class', (d) => `map-county map-county-${d.id} map-feat`),\n        (update) => update,\n        (exit) => {\n          exit.transition().duration(350).attr('opacity', 0).remove();\n        },\n      )\n      .attr('d', (d) => path(d.feature))\n      .attr('fill', fillColor);\n\n    $counties\n      .transition()\n      .duration(isFirstMapRender ? 0 : 350)\n      .attr('opacity', 1);\n\n    $g.select('#map-state-borders')\n      .datum(stateBorders)\n      .attr('d', path)\n      .attr('opacity', isCounties ? 0 : 1);\n\n    const $features = isCounties ? $counties : $states;\n\n    function onMouseEnter(d) {\n      const evt = d3event;\n      if (d.label) {\n        showMapTooltip({value: d, field, evt, allowDrilldown: allowDrilldown && !isTestingData});\n      }\n    }\n\n    const $backdrop = d3select('#map-backdrop');\n    $backdrop.attr('width', width).attr('height', height);\n    $backdrop.on('click', () => {\n      if (isCounties) {\n        setStateFilter('all');\n      }\n    });\n\n    if (isTouchDevice) {\n      $features\n        .on('click', (d) => {\n          // Dont let this bubble up to document click\n          d3event.stopPropagation();\n          onMouseEnter(d);\n        })\n        .on('mouseleave', () => {\n          hideTooltipSoon();\n        });\n    } else {\n      $features\n        .on('click', (d) => {\n          if (allowDrilldown) {\n            setStateFilter(d.label);\n          } else {\n            setStateFilter('all');\n          }\n        })\n        .on('mouseenter', onMouseEnter)\n        .on('mouseleave', () => {\n          hideTooltipSoon();\n        });\n    }\n\n    // Zoom to the correct location (anaimated on subsequent renders)\n    const $gSel = isFirstMapRender ? $g : $g.transition().duration(750);\n    if (isCounties && stateFeaturesFiltered.length) {\n      const bounds = isCounties ? path.bounds(stateFeaturesFiltered[0]) : null;\n      const xWidth = bounds[1][0] - bounds[0][0];\n      const yHeight = bounds[1][1] - bounds[0][1];\n      const xCenter = (bounds[0][0] + bounds[1][0]) / 2;\n      const yCenter = (bounds[0][1] + bounds[1][1]) / 2;\n      const scale = 0.9 / Math.max(xWidth / mapWidth, yHeight / mapHeight);\n      const translate = [mapWidth / 2 - scale * xCenter, mapHeight / 2 - scale * yCenter];\n      $gSel.attr('transform', 'translate(' + translate + ')scale(' + scale + ')');\n    } else {\n      $gSel.attr('transform', 'translate(0)scale(1)');\n    }\n\n    isFirstMapRender = false;\n  }\n\n  function renderMapLegend(clusters, min) {\n    const $legend = d3select('#map-legend');\n    $legend\n      .selectAll('.map-legend-item')\n      .data([0, min].concat(clusters))\n      .join(\n        (enter) => {\n          const $item = enter.append('div').attr('class', 'map-legend-item');\n          $item.append('div').classed('map-legend-item-label', true);\n          return $item;\n        },\n        (update) => update,\n        (exit) => exit.remove(),\n      )\n      .each(function (d, i) {\n        $(this).css('background-color', i === 0 ? mapNoDataColor : mapColors[i - 1]);\n      })\n      .select('.map-legend-item-label')\n      .text((d) => formatMapLegendTick(d));\n  }\n\n  function renderLegend() {\n    const field = filters.field;\n    if (field.toLowerCase().indexOf('tests') >= 0) {\n        $('.testing-legend').show();\n    } else {\n        $('.testing-legend').hide();\n    }\n    if (field === 'newCases' || field === 'newDeaths') {\n      $('.ma-legend .legend-field-label').text(\n        dataPointLabels[field] + (filters.per100k ? ' per 100K' : '')\n      );\n      $('.ma-legend').show();\n    } else {\n      $('.ma-legend').hide();\n    }\n  }\n\n  function renderOverview(data, options) {\n    const $overview = d3select('#svg-overview');\n    const {width, height} = $overview.node().getBoundingClientRect();\n\n    const $cell = $overview.select('g.cell');\n    $cell.selectAll('*').remove();\n\n    const useLarge = window.innerWidth >= 1024;\n    const yAxisWidth = useLarge ? 40 : 30;\n    const xAxisHeight = useLarge ? 20 : 14;\n    const marginRight = 16;\n    const cellLabelX = 6;\n    const cellLabelY = 0;\n    const chartWidth = width - yAxisWidth - marginRight;\n    const chartHeight = height - xAxisHeight;\n\n    $cell.attr('transform', `translate(${yAxisWidth}, 0)`);\n\n    renderCharts($overview, data, {\n      ...options,\n      allowDrilldown: false,\n      chartWidth,\n      chartHeight,\n      cellLabelX,\n      cellLabelY,\n      barPad: 3,\n    });\n  }\n\n  function renderGrid(data, options) {\n    const {field, datesToShow} = options;\n\n    const $svg = d3select('#grid');\n    // Make sure  we're starting fresh\n    $svg.selectAll('*').remove();\n    $svg.attr('class', filters.consistentY ? 'consistent-y' : '');\n\n    const groups = data.groups.slice(0);\n\n    const useLarge = window.innerWidth >= 1024;\n    const chartAspectRatio = 2.15;\n    const chartXPadding = useLarge ? 30 : 25;\n    const chartYPadding = useLarge ? 40 : 35;\n    const estChartWidth = useLarge ? 250 : 150;\n    const numCols = Math.floor(window.innerWidth / (estChartWidth + chartXPadding));\n    const chartWidth = Math.floor((window.innerWidth - chartXPadding * (numCols + 1)) / numCols);\n\n    const cellLabelX = -20;\n    const cellLabelY = -10;\n    const numStates = groups.length;\n    const chartHeight = Math.floor(chartWidth / chartAspectRatio);\n    const yAxisWidth = useLarge ? 40 : 30;\n    const xAxisHeight = useLarge ? 20 : 14;\n    const winWidth = window.innerWidth;\n    const barPad = datesToShow.length > 10 ? 1 : 2;\n\n    const colWidth = chartWidth + chartXPadding;\n    const rowHeight = chartHeight + xAxisHeight + chartYPadding;\n\n    const numRows = Math.ceil(numStates / numCols);\n\n    const totalHeight = numRows * rowHeight;\n\n    const allowDrilldown = !options.isCounties;\n\n    groups.forEach((g) => {\n      if (field.indexOf('new') === 0) {\n        // For daily new cases / deaths, sort by the sum of the data currently being shown\n        g.sortVal = d3sum(g.values, (v) => v[field]);\n      } else {\n        // Otherwise sort by the last shown cumulative value\n        const lastVal = findLast(g.values, (v) => v[field] != undefined);\n        g.sortVal = lastVal ? lastVal[field] : -1;\n      }\n    });\n    groups.sort((a, b) => b.sortVal - a.sortVal);\n\n    // Create grid of rows and columns\n    const $rows = $svg\n      .attr('viewBox', [0, 0, winWidth, totalHeight])\n      .selectAll('g.row')\n      .data(d3range(numRows))\n      .enter()\n      .append('g')\n      .attr('class', 'row')\n      .attr('transform', (row) => `translate(${yAxisWidth}, ${row * rowHeight})`);\n\n    // Add cells\n    $rows.each(function (row) {\n      const lastItemNumber = (row + 1) * numCols;\n      const numColsForRow = lastItemNumber > groups.length ? groups.length % numCols : numCols;\n      const range = d3range(numColsForRow).map((i) => ({row, col: i}));\n      d3select(this)\n        .selectAll('g.cell')\n        .data(range)\n        .enter()\n        .append('g')\n        .attr('class', 'cell')\n        .classed('cell-clickable', allowDrilldown && !isTestingData)\n        .attr('transform', (d) => `translate(${d.col * colWidth}, 0)`);\n    });\n\n    renderCharts(\n      $svg,\n      {\n        ...data,\n        groups,\n      },\n      {\n        ...options,\n        allowDrilldown,\n        chartWidth,\n        chartHeight,\n        cellLabelX,\n        cellLabelY,\n        barPad,\n      },\n    );\n  }\n\n  function renderCharts($svg, data, options) {\n    const {\n      field,\n      datesToShow,\n      allowDrilldown,\n      chartWidth,\n      chartHeight,\n      cellLabelX,\n      cellLabelY,\n      barPad,\n    } = options;\n    const {groups, extents} = data;\n\n    const yScaleType = filters.useLog ? d3scaleLog : d3scaleLinear;\n\n    const xScale = d3scaleBand()\n      .domain(d3range(datesToShow.length))\n      [datesToShow.length >= 90 ? 'range' : 'rangeRound']([0, chartWidth])\n      .paddingInner(Math.floor((100 * (barPad * datesToShow.length)) / chartWidth) / 100)\n      .paddingOuter(0);\n    const barWidth = xScale.bandwidth();\n\n    const barXMidpoints = datesToShow.map((d, i) => {\n      return xScale(i) + barWidth / 2;\n    });\n\n    function makeYScale(extent) {\n      const domain = [0, Math.max(extent[1], filters.per100k ? 0.1 : 10)];\n      if (filters.useLog) {\n        const extentMin = Math.max(extent[0], 0) || (filters.per100k ? 0.01 : 1);\n        // Make sure domain start is small enough such that even really small numbers show a bar\n        domain[0] = 1;\n        while (domain[0] >= extentMin) {\n          domain[0] /= 10;\n        }\n      }\n      return yScaleType().domain(domain).range([chartHeight, 0]).nice();\n    }\n\n    function makeAxis(scale) {\n      const domainMax = scale.domain()[1];\n      let numTicks = 4;\n      if (filters.useLog) {\n        if (filters.per100k) {\n          // numTicks > 2 here can create 10+ ticks\n          numTicks = 3;\n        } else {\n          numTicks = domainMax < 100 ? 1 : domainMax < 1000 ? 2 : domainMax < 10000 ? 3 : 4;\n        }\n      }\n      // Make sure there arent too many ticks (happens particularly often with log scale + per100k)\n      while (scale.ticks(numTicks).length > 5) {\n        numTicks--;\n      }\n      return d3axisLeft(scale)\n        .ticks(numTicks)\n        .tickSizeInner(-chartWidth)\n        .tickSizeOuter(0)\n        .tickFormat((d) => {\n          return formatYTick(d);\n        });\n    }\n    const yScale = makeYScale(extents[field]);\n    const yAxis = makeAxis(yScale);\n\n    const $cells = $svg.selectAll('g.cell');\n\n    // Fill each cell with a chart\n    let counter = 0;\n    $cells.each(function (d, index) {\n      const $cell = d3select(this);\n      const data = groups[index];\n      if (!data) {\n        return;\n      }\n      counter++;\n      const values = data.values;\n\n      // Add baseline\n      $cell\n        .append('line')\n        .attr('class', 'baseline')\n        .attr('y1', chartHeight)\n        .attr('y2', chartHeight)\n        .attr('x2', chartWidth);\n\n      // Add axis\n      let cellYScale = yScale;\n      let cellYAxis = yAxis;\n      if (!filters.consistentY) {\n        let extent = d3extent(values, (d) => d[field]);\n        // Account for moving average values in extent\n        if (fieldHasMovingAverage[field]) {\n          const maField = maKey(field);\n          const maExtent = d3extent(values, (d) => d[maField]);\n          extent = d3extent(extent.concat(maExtent));\n        }\n        cellYScale = makeYScale(extent);\n        cellYAxis = makeAxis(cellYScale);\n      }\n\n      $cell.append('g').attr('transform', 'translate(0,0)').call(cellYAxis);\n\n      let stackFields;\n      if (isTestingData) {\n        stackFields =\n          filters.field === 'newTests' ? ['newPositive', 'newNegative'] : ['positive', 'negative'];\n        if (filters.per100k) {\n          stackFields = stackFields.map(per100kKey);\n        }\n      } else {\n        stackFields = [field];\n      }\n\n      function renderLine(yProperty, classes) {\n        const xOffset = barWidth / 2;\n        const line = d3line()\n          .x((d, i) => Math.round(xScale(i) + xOffset))\n          .y((d) => {\n            const y = Math.min(Math.floor(cellYScale(d[yProperty])), chartHeight);\n            return Number.isNaN(y) ? chartHeight : y;\n          })\n          .curve(d3curveMonotoneX);\n\n        $cell.append('path').attr('class', classes).datum(values).attr('d', line);\n      }\n\n      const stack = d3stack().keys(stackFields)(values);\n      const $layers = $cell\n        .selectAll('g.layer')\n        .data(stack, (d) => d.key)\n        .enter()\n        .append('g')\n        .attr('class', (d, i) => {\n          return `layer layer-${i + 1} layer-${d.key}`;\n        });\n\n      // Render bars if we're not looking at \"All\" data\n      if (filters.time !== 'all') {\n        $layers\n          .selectAll('.bar')\n          .data(\n            (l) => l,\n            (d) => String(d.data.date.getTime()),\n          )\n          .enter()\n          .append('rect')\n          .attr('class', 'bar')\n          .attr('width', barWidth)\n          .attr('x', (d, i) => xScale(i))\n          .attr('y', (d) => {\n            const y = cellYScale(d[1]);\n            return Number.isNaN(y) ? chartHeight : y;\n          })\n          .attr('height', (d) => {\n            const y = Math.max(chartHeight - cellYScale(d[1] - d[0]), 0);\n            return Number.isNaN(y) ? 0 : y;\n          });\n      }\n      // If there are multiple stack fields, use an area chart\n      else if (stackFields.length > 1) {\n        const area = d3area()\n          .x((d, i) => xScale(i))\n          .y0(d => cellYScale(Math.max(d[0] || 0, 0)))\n          .y1(d => cellYScale(Math.max(d[1] || 0, 0)))\n        $layers\n          .append('path')\n          .attr('class', 'area')\n          .attr('d', area);\n      }\n      // Fall back to line chart (unless there's already a moving avg line)\n      else if(!fieldHasMovingAverage[field]) {\n        renderLine(field, 'chart-line');\n      }\n\n      // Render the moving average line\n      if (fieldHasMovingAverage[field]) {\n        renderLine(maKey(field), 'chart-line ma-line');\n      } else {\n        $cell.selectAll('.ma-line').remove();\n      }\n\n      const $crosshair = $cell\n        .append('line')\n        .attr('y1', 0)\n        .attr('y2', chartHeight)\n        .attr('class', 'crosshair crosshair-hidden');\n\n      function onMouseMove() {\n        const evt = d3event;\n        const mouse = d3mouse(this);\n        const xPos = mouse[0];\n        const bisectIndex = d3bisectLeft(barXMidpoints, xPos);\n        const left = barXMidpoints[bisectIndex - 1];\n        const right = barXMidpoints[bisectIndex];\n        const index =\n          left == undefined || Math.abs(xPos - right) < Math.abs(xPos - left)\n            ? bisectIndex\n            : bisectIndex - 1;\n        const date = datesToShow[index];\n        const value = values.find((v) => v.date.getTime() === date.getTime());\n        if (value && (value !== tooltipValue || !tooltipShown)) {\n          const chPos = Math.round(xScale(index) + barWidth / 2);\n          $crosshair.attr('x1', chPos).attr('x2', chPos).classed('crosshair-hidden', false);\n          showChartTooltip({value, field, evt, allowDrilldown: allowDrilldown && !isTestingData});\n        }\n      }\n\n      function onClick() {\n        if (allowDrilldown) {\n          setStateFilter(data.key);\n          scrollUpTo('#viz');\n        }\n      }\n\n      const $hover = $cell\n        .append('rect')\n        .attr('class', 'pointer')\n        .attr('width', chartWidth)\n        .attr('height', chartHeight);\n\n      // Touch device events are slightly different\n      if (isTouchDevice) {\n        $hover.on('click', () => {\n          // Dont let this bubble up to document click\n          d3event.stopPropagation();\n          onMouseMove.call(this);\n        });\n      } else {\n        $hover.on('mousemove', onMouseMove).on('click', onClick);\n      }\n      $cell.on('mouseleave', () => {\n        $crosshair.classed('crosshair-hidden', true);\n        hideTooltipSoon();\n      });\n\n      // Add label above other elements to make it clickable\n      $cell\n        .append('text')\n        .text(groups.length > 1 ? `${counter}. ${data.key}` : data.key)\n        .attr('x', cellLabelX)\n        .attr('y', cellLabelY)\n        .attr('class', 'cell-label')\n        .on('click', onClick);\n\n      if (filters.per100k && data.noPopulation) {\n        $cell\n          .append('text')\n          .text('No population data')\n          .attr('x', chartWidth / 2)\n          .attr('y', chartHeight / 2)\n          .attr('class', 'cell-label-nopop');\n      }\n    });\n\n    // Add X date ticks\n    $cells\n      .append('text')\n      .attr('class', 'x-tick x-tick-start')\n      .attr('text-anchor', 'start')\n      .attr('x', 0)\n      .attr('y', chartHeight + 4)\n      .text(formatXDate(datesToShow[0]));\n\n    $cells\n      .append('text')\n      .attr('class', 'x-tick x-tick-end')\n      .attr('text-anchor', 'end')\n      .attr('x', chartWidth)\n      .attr('y', chartHeight + 4)\n      .text(formatXDate(last(datesToShow)));\n  }\n\n  function showMapTooltip(options) {\n    const {value} = options;\n    showTooltip({\n      ...options,\n      title: value.label,\n      subtitle: timeLabels[filters.time],\n      fieldLabels: mapDataPointLabels,\n    });\n  }\n\n  const _MS_PER_DAY = 1000 * 60 * 60 * 24;\n  function dateDiffInDays(b, a) {\n    const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());\n    const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());\n    return Math.floor((utc2 - utc1) / _MS_PER_DAY);\n  }\n\n  function showChartTooltip(options) {\n    const {value} = options;\n    showTooltip({\n      ...options,\n      title: formatTooltipDate(value.date),\n      fieldLabels: dataPointLabels,\n    });\n  }\n\n  function showTooltip(options) {\n    clearTimeout(tooltipHideTimer);\n    const {value, field, evt, allowDrilldown, title, subtitle, fieldLabels} = options;\n    tooltipValue = value;\n    tooltipShown = true;\n    const pageX = evt.pageX;\n    const pageY = evt.pageY;\n    const clientY = evt.clientY;\n    const pad = 10;\n    const css = {left: '', right: '', top: '', bottom: '', transform: ''};\n    const winWidth = window.innerWidth;\n    const winHeight = window.innerHeight;\n    const bodyHeight = document.body.getBoundingClientRect().height;\n\n    const fitsLeft = pageX - 250 > 0;\n    const fitsRight = pageX + 250 < winWidth;\n    const fitsTop = clientY - 250 > 0;\n    const fitsBottom = clientY - 250 < winHeight;\n\n    if (fitsTop) {\n      css.bottom = `${bodyHeight - pageY + pad}px`;\n    } else {\n      css.top = `${pageY + pad}px`;\n    }\n\n    if (fitsRight) {\n      css.left = `${pageX + pad}px`;\n    } else if (fitsLeft) {\n      css.right = `${winWidth - pageX + pad}px`;\n    } else if (fitsTop || !fitsBottom) {\n      css.left = pageX;\n      css.transform = 'translateX(-50%)';\n      css.bottom = `${bodyHeight - pageY + pad}px`;\n    } else if (fitsBottom) {\n      css.left = pageX;\n      css.transform = 'translateX(-50%)';\n      css.top = `${pageY + pad}px`;\n    }\n\n    const hasPercents = isTestingData;\n    const columnClass = hasPercents ? 'col-3' : 'col-2';\n\n    let dataPoints;\n    if (filters.field === 'tests') {\n      dataPoints = [\n        {key: 'positive', color: 'primary1', pct: value.positivePct},\n        {key: 'negative', color: 'primary2', pct: value.negativePct},\n        {key: 'cases'},\n        {key: 'deaths'},\n      ];\n    } else if (filters.field === 'newTests') {\n      dataPoints = [\n        {key: 'newPositive', color: 'primary1', pct: value.newPositivePct},\n        {key: 'newNegative', color: 'primary2', pct: value.newNegativePct},\n        {key: 'newCases'},\n        {key: 'newDeaths'},\n      ];\n    } else if (filters.field.indexOf('new') === 0) {\n      dataPoints = ['newCases', 'newDeaths'].map((k) => ({\n        key: k,\n        color: k === field ? 'primary1' : null,\n      }));\n    } else {\n      dataPoints = ['cases', 'deaths'].map((k) => ({\n        key: k,\n        color: k === field ? 'primary1' : null,\n      }));\n    }\n    if (filters.per100k) {\n      dataPoints = dataPoints.map((dp) => ({\n        ...dp,\n        key: per100kKey(dp.key),\n        suffix: ' per 100k',\n        formatter: formatPer100kValue,\n      }));\n      if (value.pop != undefined) {\n        dataPoints.push({\n          key: 'pop',\n        });\n      }\n    }\n    const dataPointEl = dataPoints.map((dp) => {\n      const format = dp.formatter || formatTooltipValue;\n      const dpValue = value[dp.key];\n      if (dpValue == undefined) {\n        return '';\n      }\n      return `\n        \t<div class=\"tooltip-dp-label ${dp.color || ''}\">${fieldLabels[dp.key]}</div>\n        \t<div class=\"tooltip-dp-val\">${format(dpValue)}${dp.suffix || ''}</div>\n          ${\n            hasPercents\n              ? `\n            <div class=\"tooltip-dp-pct\">\n              ${formatTooltipPct(dp.pct)}\n            </div>\n          `\n              : ''\n          }\n        \t`;\n    });\n\n    const drilldownMsg = allowDrilldown\n      ? '<div class=\"tooltip-drill\"><span class=\"click\">Click</span><span class=\"tap\">Tap</span><span> to see counties</span></div>'\n      : '';\n\n    $('#tooltip')\n      .addClass('shown')\n      .toggleClass('clickable', allowDrilldown)\n      .css(css)\n      .html(\n        `<div><h4>${title}</h4>\n        ${subtitle ? `<h5>${subtitle}</h5>` : ''}\n              <div class=\"tooltip-grid ${columnClass}\">\n                ${dataPointEl.join('')}\n              </div>\n              ${drilldownMsg}</div>`,\n      );\n  }\n\n  // Sometimes we want to delay hiding to allow user to click into tooltip before it hides (i.e. on mobile)\n  function hideTooltipSoon() {\n    // Long delay needed for iOS safari, otherwise tooltip hides\n    tooltipHideTimer = setTimeout(hideTooltip, isTouchDevice ? 500 : 50);\n  }\n  function hideTooltip() {\n    $('#tooltip').removeClass('shown');\n    tooltipShown = false;\n  }\n\n  function formatXDate(d) {\n    return d.toLocaleString('default', {month: 'short', day: 'numeric'});\n  }\n\n  function formatTooltipDate(d) {\n    return d.toLocaleString('default', {year: 'numeric', month: 'long', day: 'numeric'});\n  }\n\n  function formatYTick(n) {\n    const str = formatNumNice(n);\n    return str.replace(/^0\\./, '.');\n  }\n\n  function formatNumNice(n, precision) {\n    let abbrev;\n    if (n >= 1e6) {\n      n = n / 1e6;\n      abbrev = 'm';\n    } else if (n >= 1e3) {\n      n = n / 1e3;\n      abbrev = 'k';\n    }\n    if (precision !== undefined) {\n      // Need to parseFloat again to avoid scientific notation\n      n = parseFloat(n.toPrecision(precision));\n    }\n    return abbrev ? `${n}${abbrev}` : String(n);\n  }\n\n  const tooltipFmtPer100k = d3format(',.1f');\n  const tooltipFmtPer100kSmall = d3format(',.2f');\n  function formatPer100kValue(n) {\n    return n >= 1 ? tooltipFmtPer100k(n) : tooltipFmtPer100kSmall(n);\n  }\n\n  const tooltipFmt = d3format(',d');\n  function formatTooltipValue(n) {\n    return tooltipFmt(n);\n  }\n\n  function formatMapLegendTick(n) {\n    return formatNumNice(n, 2);\n  }\n\n  const pctFmt = d3format('.1%');\n  function formatTooltipPct(n) {\n    return n != undefined ? `(${pctFmt(n)})` : '';\n  }\n\n  function setStateFilter(state) {\n    router.push({[filterKeys.state]: state});\n  }\n\n  function scrollUpTo(selector) {\n    const el = document.querySelector(selector);\n    if (!el || !el.scrollIntoView) {\n      window.scrollTo(0, 0);\n    }\n    // Only scroll _up_ to target\n    if (el.getBoundingClientRect().top >= 0) {\n      return;\n    }\n    el.scrollIntoView({behavior: 'smooth', block: 'start'});\n  }\n\n  function attachEvents() {\n    $('#state-select').change(function () {\n      const val = $(this).val();\n      setStateFilter(val);\n    });\n    $('.back-to-states').click(function () {\n      setStateFilter('all');\n      scrollUpTo('#viz-map');\n    });\n    $('#field-select').change(function () {\n      router.push({\n        [filterKeys.field]: $(this).val(),\n      });\n    });\n    $('#time-select').change(function () {\n      router.push({[filterKeys.time]: $(this).val()});\n    });\n    $('#tooltip').click(function (evt) {\n      // Dont let this bubble up to the document.click hide event\n      evt.stopPropagation();\n      if ($(this).is('.clickable') && tooltipValue) {\n        setStateFilter(tooltipValue.state || tooltipValue.label);\n        // Scroll to top if this was a chart (not map) click\n        if (!tooltipValue.label) {\n          scrollUpTo('#viz');\n        }\n      }\n    });\n    $('#cb-use-log-scale').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.useLog]: value ? '1' : '0'});\n    });\n    $('#cb-per-100k').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.per100k]: value ? '1' : '0'});\n    });\n    $('#cb-consistent-y').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.consistentY]: value ? '1' : '0'});\n    });\n    $(document).on('click', function () {\n      hideTooltipSoon();\n    });\n  }\n\n  let loadingCount = 0;\n  function startLoading() {\n    loadingCount++;\n    $('.wrapper').addClass('loading');\n  }\n  function completeLoading() {\n    loadingCount--;\n    if (loadingCount <= 0) {\n      $('.wrapper').removeClass('loading');\n      // Just in case this somehow gets below 0\n      loadingCount = 0;\n    }\n  }\n\n  function renderAllStates() {\n    render({groups: stateData, overview: usData});\n    $('.back-to-states').removeClass('shown');\n    hideTooltip();\n  }\n\n  function renderCounties(state) {\n    const countiesForState = countyData[state];\n\n    const overviewData = stateData.filter((s) => s.key === state);\n    const stateFips = overviewData ? overviewData[0].values[0].fips : null;\n\n    render({\n      groups: countiesForState.counties,\n      overview: overviewData,\n      isCounties: true,\n      stateFips,\n    });\n\n    $('.back-to-states').addClass('shown');\n    hideTooltip();\n  }\n\n  const resizeWindow = throttle(() => {\n    if (lastData) {\n      render(lastData);\n    }\n  }, 100);\n  window.addEventListener('resize', resizeWindow);\n\n  function fetchMapData() {\n    if (!fetchMapData.promise) {\n      fetchMapData.promise = d3json('assets/us-counties.topojson').then((us) => {\n        stateFeatures = topojson.feature(us, us.objects.states).features;\n        stateBorders = topojson.mesh(us, us.objects.states, (a, b) => a !== b);\n        countyFeatures = topojson.feature(us, us.objects.counties).features;\n      });\n    }\n    return fetchMapData.promise;\n  }\n\n  function populateStateSelect(stateData) {\n    if (populateStateSelect.populated) {\n      return;\n    }\n    populateStateSelect.populated = true;\n\n    const stateOptions = stateData\n      .slice(0)\n      .sort((a, b) => a.key.localeCompare(b.key))\n      .map((s) => `<option value=\"${s.key}\">${s.key}</option>`)\n      .join('');\n    $('#state-select').html(`<option value=\"all\" selected>All States</option>${stateOptions}`);\n    if (filters.state !== 'all') {\n      $('#state-select').val(filters.state);\n    }\n  }\n\n  const fetchStatePopulationsMemo = memoizeOne(() => {\n    return new Promise((resolve, reject) => {\n      d3csv('assets/fips-pop-sta.csv')\n        .then((popCsv) => {\n          const popMap = processPopulations(popCsv);\n          resolve(popMap);\n        })\n        .catch(reject);\n    });\n  });\n\n  const fetchCountyPopulationsMemo = memoizeOne(() => {\n    return new Promise((resolve, reject) => {\n      d3csv('assets/fips-pop-cty.csv')\n        .then((popCsv) => {\n          const popMap = processPopulations(popCsv);\n          resolve(popMap);\n        })\n        .catch(reject);\n    });\n  });\n\n  const fetchStateDataMemo = memoizeOne((timeFilter) => {\n    return new Promise((resolve, reject) => {\n      const file = timeFilter === 'all' ? 'all' : '90d';\n      Promise.all([\n        d3csv(\n          `https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/state/${file}.csv`,\n        ),\n        fetchStatePopulationsMemo(),\n      ])\n        .then(([csv, statePop]) => {\n          processStates(csv, statePop);\n          populateStateSelect(stateData);\n          resolve();\n        })\n        .catch(reject);\n    });\n  });\n\n  const fetchCountyDataMemo = memoizeOne((state, timeFilter) => {\n    return new Promise((resolve, reject) => {\n      // Need to fetch state data first to make sure state => fips mapping is ready\n      fetchStateData()\n        .then(() => {\n          const timeDir = timeFilter === 'all' ? 'all' : '90d';\n          const fips = stateToFipsMap[state];\n          if (!fips) {\n            reject(new Error(`Could not find fips for state ${state}`));\n            return;\n          }\n\n          Promise.all([\n            d3csv(\n              `https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/county/${timeDir}/${fips}.csv`,\n            ),\n            fetchCountyPopulationsMemo(),\n          ])\n            .then(([csv, countyPop]) => {\n              processCounties(csv, countyPop);\n              resolve();\n            })\n            .catch(reject);\n        })\n        .catch(reject);\n    });\n  });\n\n  function fetchStateData() {\n    return fetchStateDataMemo(filters.time);\n  }\n\n  function fetchCountyData(state) {\n    return fetchCountyDataMemo(state, filters.time);\n  }\n\n  function fetchAndRenderStates() {\n    startLoading();\n    fetchStateData()\n      .then(() => {\n        renderAllStates();\n        completeLoading();\n      })\n      .catch((error) => {\n        console.error(error);\n        completeLoading();\n      });\n  }\n\n  function fetchAndRenderCounties(state) {\n    startLoading();\n    fetchCountyData(state)\n      .then(() => {\n        renderCounties(state);\n        completeLoading();\n      })\n      .catch((error) => {\n        console.error(error);\n        completeLoading();\n      });\n  }\n\n  if (filters.state === 'all') {\n    fetchAndRenderStates();\n  } else {\n    fetchAndRenderCounties(filters.state);\n  }\n\n  attachEvents();\n})();\n"],"sourceRoot":""}